<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°å›¾å¯»è·¯</title>
    <style>
        div {
            margin: 0;
            padding: 0;
        }
       body {
           display: flex;
           align-items: center;
           position: fixed;
           top: 0;
           bottom: 0;
           left: 0;
           right: 0;
       }
        .cell {
            /* background-color: greenyellowyellow; */
            line-height: 8px;
            width: 7px;
            height: 7px;
            border-bottom: 1px white solid;
            border-right: 1px white solid;
            background: rgba(0, 0, 0, .3);
            display: inline-block;
            vertical-align: top;
        }
    </style>
</head>

<body>
    <div id="container" style="width: 806px;line-height: 8px;margin: 0 auto;"></div>
    <button onclick="find()">find</button>
    <script>
        let pathcache = new Map();
        let map = localStorage['map'] ? localStorage['map'] : new Array(10000).fill(0);
        let container = document.querySelector('#container');
        let clear = false;
        let mousedown = false;
        for (let i = 0; i < 100; i++) {
            for (let j = 0; j < 100; j++) {
                let cell = document.createElement('div');
                cell.classList.add("cell");
                container.appendChild(cell);
                cell.addEventListener('mousemove', () => {
                    console.log('bubbp')
                    if (mousedown) {
                        if (clear) {
                            map[i*100 + j] = 0;
                            cell.style.background = "";
                        }else {
                            map[i*100 + j] = 1;
                            cell.style.background = "black";
                        }
                    }
                })
            }
        }

        document.addEventListener('mousedown', (event) => {
            console.log(event);
            mousedown = true;
            clear = event.which === 1
        })
        document.addEventListener('mouseup', (event) => {
            mousedown = false;
        })
        document.addEventListener('contextmenu', (e) => e.preventDefault());
        async function sleep(time) {
            return new Promise((resolve) => {
                setTimeout(resolve, time);
            })
        }
        async function path(map, start, end) {
            let queue = new Sorted([start], (a, b) => distance(a, end)-distance(b, end));
            container.children[100*0 + 0].style.background = "greenyellow";
            map[0] = 2;
            
            async function insert(x, y) {
                if (x < 0 || x > 99) return;
                if (y < 0 || y > 99) return;
                if (map[100*x + y]) return;
                map[100*x + y] = 2;
                queue.give([x, y]);
                await sleep(50);
                container.children[100*x + y].style.background = "greenyellow";
            }

            while(queue.qSise > 0) {
                let qsize = queue.qSise;
                while(qsize --) {
                    let cur = queue.take();
                    console.log(cur);
                    let dir = [[1, 0], [0, 1], [-1, 0], [0, -1]];
                    let next;
                    for (let i = 0;i < dir.length;i ++) {
                        let e = dir[i];
                        next = [cur[0]+e[0], cur[1]+e[1]];
                        if (next[0] == end[0] && next[1] == end[1]) {
                            console.log('find ðŸ˜‚')
                            return true;
                        }
                        await insert(next[0], next[1]);
                    }
                }
            }
            console.log('not find ðŸ˜¥')
            return false;
        }

        function find() {
            path(map, [0,0], [50, 50])
        }

        class Sorted {
            constructor(data, compare) {
                this.data = data.slice();
                Object.defineProperty(this, 'qSise', {
                    get: function() {
                        return this.data.length;
                    },
                    set: function(value) {
                        console.log('resize')
                    }
                })
                this.compare = compare?compare:(a, b) => a-b;
            }

            take() {
                let size = this.data.length;
                if (size === 0) return;
                let min = this.data[0];
                let minIndex = 0;
                for (let i = 1;i < size;i ++) {
                    if (this.compare(this.data[i], min) < 0) {
                        min = this.data[i];
                        minIndex = i;
                    }
                }
                this.data[minIndex] = this.data[size-1];
                this.data.pop();
                this.qSise = this.data.length;
                return min;
            }

            give(value) {
                this.data.push(value);
                this.qSise = this.data.length;
            }
        }
        function distance(a, b) {
            let x = a[0] - b[0], y = a[1] - b[1];
            return x ** 2 + y ** 2;
        }
    </script>
</body>

</html>